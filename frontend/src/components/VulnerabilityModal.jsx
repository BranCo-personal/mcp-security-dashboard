import React from 'react';
import { X, AlertTriangle, Shield, BookOpen, Wrench } from 'lucide-react';

function VulnerabilityModal({ vulnerability, onClose }) {
  const {
    tool_name,
    vulnerability_type,
    risk_level,
    description,
    evidence,
    owasp_mapping,
    remediation,
  } = vulnerability;

  const riskColors = {
    CRITICAL: 'text-red-400 bg-red-900/50',
    HIGH: 'text-orange-400 bg-orange-900/50',
    MEDIUM: 'text-yellow-400 bg-yellow-900/50',
    LOW: 'text-blue-400 bg-blue-900/50',
    INFO: 'text-gray-400 bg-gray-800',
  };

  const formatType = (type) => {
    return type
      ?.replace(/_/g, ' ')
      .replace(/\b\w/g, (c) => c.toUpperCase());
  };

  return (
    <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
      <div className="bg-gray-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-gray-700">
          <div className="flex items-center gap-3">
            <AlertTriangle className="w-6 h-6 text-red-400" />
            <div>
              <h2 className="text-lg font-semibold text-white">Vulnerability Details</h2>
              <p className="text-sm text-gray-400">{formatType(vulnerability_type)}</p>
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-700 rounded-lg transition-colors"
          >
            <X className="w-5 h-5 text-gray-400" />
          </button>
        </div>

        {/* Content */}
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-80px)]">
          {/* Risk Level & Tool */}
          <div className="flex items-center gap-3 mb-6">
            <span className={`px-3 py-1 rounded-full text-sm font-medium ${riskColors[risk_level]}`}>
              {risk_level} RISK
            </span>
            <span className="font-mono text-sm bg-gray-700 px-3 py-1 rounded">
              {tool_name}
            </span>
          </div>

          {/* Description */}
          <div className="mb-6">
            <h3 className="text-sm font-medium text-gray-400 uppercase tracking-wide mb-2">
              Description
            </h3>
            <p className="text-gray-200">{description}</p>
          </div>

          {/* Evidence */}
          {evidence && (
            <div className="mb-6">
              <h3 className="text-sm font-medium text-gray-400 uppercase tracking-wide mb-2 flex items-center gap-2">
                <Shield className="w-4 h-4" />
                Evidence
              </h3>
              <div className="bg-gray-900 rounded-lg p-4 font-mono text-sm text-red-300 whitespace-pre-wrap">
                {evidence}
              </div>
            </div>
          )}

          {/* OWASP Mapping */}
          {owasp_mapping && (
            <div className="mb-6">
              <h3 className="text-sm font-medium text-gray-400 uppercase tracking-wide mb-2 flex items-center gap-2">
                <BookOpen className="w-4 h-4" />
                OWASP LLM Top 10
              </h3>
              <a
                href="https://genai.owasp.org/"
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 bg-blue-900/50 text-blue-300 px-3 py-2 rounded-lg hover:bg-blue-900 transition-colors"
              >
                {owasp_mapping}
                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
              </a>
            </div>
          )}

          {/* Remediation */}
          <div className="mb-6">
            <h3 className="text-sm font-medium text-gray-400 uppercase tracking-wide mb-2 flex items-center gap-2">
              <Wrench className="w-4 h-4" />
              Remediation
            </h3>
            <div className="bg-green-900/30 border border-green-800 rounded-lg p-4">
              <p className="text-green-200">
                {remediation || 'Review and sanitize tool descriptions before deployment. Implement input validation and output filtering for all MCP tools.'}
              </p>
            </div>
          </div>

          {/* Additional Resources */}
          <div className="border-t border-gray-700 pt-6">
            <h3 className="text-sm font-medium text-gray-400 uppercase tracking-wide mb-3">
              Learn More
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              <ResourceLink
                href="https://modelcontextprotocol.io/docs/concepts/security"
                title="MCP Security Docs"
                description="Official security best practices"
              />
              <ResourceLink
                href="https://genai.owasp.org/"
                title="OWASP GenAI Project"
                description="Top 10 LLM vulnerabilities"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

function ResourceLink({ href, title, description }) {
  return (
    <a
      href={href}
      target="_blank"
      rel="noopener noreferrer"
      className="block bg-gray-700/50 hover:bg-gray-700 rounded-lg p-3 transition-colors"
    >
      <p className="font-medium text-white">{title}</p>
      <p className="text-sm text-gray-400">{description}</p>
    </a>
  );
}

export default VulnerabilityModal;
